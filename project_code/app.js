// Generated by CoffeeScript 1.6.3
(function() {
  $(document).ready(function() {
    var animateOneMoreMandala, mandala, mandalas, mandalasToAnimate, pen, startAnimation;
    mandalas = $(".mandala");
    $("#accelerator").css("transform", "rotate(90deg)");
    $("#accelerator").on("change", function() {
      var actualAnimation, changeRotation, image, rpm, _i, _len;
      $("#turn_on_motor").prop("checked", true);
      rpm = parseInt(60 * (1.0 / parseFloat($('#accelerator').val())));
      $('#velocimeter').text("" + rpm + " rpm");
      for (_i = 0, _len = mandalas.length; _i < _len; _i++) {
        image = mandalas[_i];
        image.style.webkitAnimationPlayState = "paused";
      }
      actualAnimation = "rotation " + ($('#accelerator').val()) + "s infinite linear";
      changeRotation = function() {
        var _j, _len1, _results;
        _results = [];
        for (_j = 0, _len1 = mandalas.length; _j < _len1; _j++) {
          image = mandalas[_j];
          image.style.webkitAnimation = actualAnimation;
          _results.push(image.style.webkitAnimationPlayState = "running");
        }
        return _results;
      };
      return setTimeout(changeRotation, 500);
    });
    $("#turn_on_motor").on("change", function() {
      var image, state, _i, _len, _results;
      if (this.checked) {
        state = "running";
      } else {
        state = "paused";
      }
      _results = [];
      for (_i = 0, _len = mandalas.length; _i < _len; _i++) {
        image = mandalas[_i];
        _results.push(image.style.webkitAnimationPlayState = state);
      }
      return _results;
    });
    pen = null;
    startAnimation = function() {
      if (pen) {
        pen.Stop();
      }
      return pen = new Pen("background_animation", 7.77, 11, 242, 111, 'yellow');
    };
    mandalasToAnimate = mandalas.toArray();
    mandalas.show();
    mandala = null;
    animateOneMoreMandala = function() {
      if (mandala !== null) {
        mandala.style.webkitAnimationPlayState = "paused";
        $(mandala).hide();
      }
      if (mandala = mandalasToAnimate.shift()) {
        console.log("animating ", mandala);
        mandala.style.webkitAnimationPlayState = "paused";
        mandala.webkitAnimation = "scale 8s linear, rotation " + ($("#accelerator").val()) + "s infinite linear";
        return mandala.style.webkitAnimationPlayState = "running";
      } else {
        console.log("terminou ... mandalas");
        clearInterval(animatingMandalas);
        delete animatingMandalas;
        return $(mandalas).show();
      }
    };
    window.animatingMandalas = setInterval(animateOneMoreMandala, 8000);
    return startAnimation();
  });

}).call(this);
